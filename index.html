<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>掷筊 - 佛祖灵应</title>
    <style>
        :root { --wood-red: #8b0000; --flat-red: #d32f2f; --gold: #ffd700; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            background: radial-gradient(circle at center, #2c0000 0%, #1a1a1a 100%); 
            color: white; text-align: center; font-family: "STKaiti", "KaiTi", serif; 
            margin: 0; overflow: hidden; touch-action: none;
        }

        .container { 
            height: 100vh; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; /* 居中分布 */
            padding: 20px; gap: 4vh; /* 统一元素间距 */
        }

        h1 { font-size: 1.5rem; margin: 0; color: var(--gold); }

        /* 记录面板 */
        .record-panel { display: flex; gap: 8px; width: 100%; justify-content: center; }
        .record-slot { 
            flex: 1; max-width: 80px; height: 75px; 
            border: 1px dashed #666; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05);
        }
        .record-slot.active { border-color: var(--gold); background: rgba(255,215,0,0.1); }
        .slot-tag { font-size: 10px; color: #888; }
        .slot-val { font-size: 1rem; font-weight: bold; margin-top: 4px; }

        /* 筊杯区域 */
        .bwei-box { 
            display: flex; gap: 10%; height: 20vh; 
            align-items: center; justify-content: center; width: 100%;
            perspective: 1200px;
        }
        .bwei {
            position: relative; width: 25vw; max-width: 100px; aspect-ratio: 2 / 1;
            transform-style: preserve-3d; transition: transform 0.8s ease-out;
        }
        .side-curved, .side-flat {
            position: absolute; width: 100%; height: 100%;
            border-radius: 100px 100px 10px 10px; backface-visibility: hidden;
        }
        .side-curved { background: radial-gradient(circle, #a00, #500); box-shadow: inset 0 -3px 8px rgba(0,0,0,0.6); }
        .side-flat { background: #d32f2f; transform: rotateX(180deg); border-bottom: 2px solid #700; }

        .tossing { animation: toss-anim 0.8s ease-in-out; }
        @keyframes toss-anim {
            0% { transform: translateY(0) rotateX(0); }
            50% { transform: translateY(-25vh) rotateX(720deg); }
            100% { transform: translateY(0); }
        }

        #status { font-size: 1rem; color: var(--gold); height: 1.2rem; font-weight: bold; }

        /* 底部控制区：改为左右排列 */
        .controls { 
            display: flex; gap: 15px; width: 100%; max-width: 320px; 
            justify-content: center; align-items: center;
        }
        button {
            padding: 12px 20px; font-size: 1.1rem; border-radius: 25px; cursor: pointer;
            font-family: inherit; transition: 0.3s; border: none;
        }
        .btn-main { flex: 2; background: #b71c1c; color: var(--gold); border: 2px solid var(--gold); font-weight: bold; }
        .btn-sub { flex: 1; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid #444; font-size: 0.9rem; }
        button:disabled { opacity: 0.3; }
        button:active { transform: scale(0.92); }

        /* 弹窗 */
        #final-verdict-box { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 80%; max-width: 280px; background: rgba(20,0,0,0.98); 
            border: 2px solid var(--gold); padding: 25px; border-radius: 15px; z-index: 100; 
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #final-verdict-box.show { transform: translate(-50%, -50%) scale(1); }
    </style>
</head>
<body>

<div class="container">
    <h1>⛩️ 虔诚祈祷 三掷定音 ⛩️</h1>

    <div class="record-panel">
        <div class="record-slot" id="slot-0"><span class="slot-tag">一掷</span><span class="slot-val" id="val-0">-</span></div>
        <div class="record-slot" id="slot-1"><span class="slot-tag">二掷</span><span class="slot-val" id="val-1">-</span></div>
        <div class="record-slot" id="slot-2"><span class="slot-tag">三掷</span><span class="slot-val" id="val-2">-</span></div>
    </div>

    <div id="status">请点击掷筊</div>

    <div class="bwei-box">
        <div id="bwei1" class="bwei"><div class="side-curved"></div><div class="side-flat"></div></div>
        <div id="bwei2" class="bwei"><div class="side-curved"></div><div class="side-flat"></div></div>
    </div>

    <div class="controls">
        <button id="tossBtn" class="btn-main" onclick="toss()">掷 筊</button>
        <button class="btn-sub" onclick="resetAll()">重置</button>
    </div>
</div>

<div id="final-verdict-box">
    <div style="font-size: 0.9rem; color: #aaa;">佛祖最终旨意</div>
    <div id="final-title" style="font-size: 3rem; font-weight: bold; margin: 10px 0;"></div>
    <div id="final-desc" style="font-size: 1rem; color: #fff; margin-bottom: 20px;"></div>
    <button class="btn-main" style="width:100%;" onclick="closeVerdict()">了然</button>
</div>

<script>
    let currentStep = 0;
    let historyResults = [];

    function toss() {
        if (currentStep >= 3) return;
        const b1 = document.getElementById('bwei1'), b2 = document.getElementById('bwei2');
        const btn = document.getElementById('tossBtn'), status = document.getElementById('status');

        btn.disabled = true;
        status.innerText = "佛祖定夺中...";
        b1.classList.remove('tossing'); b2.classList.remove('tossing');
        void b1.offsetWidth;

        const res1 = Math.random() > 0.5 ? 0 : 1, res2 = Math.random() > 0.5 ? 0 : 1;
        b1.classList.add('tossing'); b2.classList.add('tossing');

        setTimeout(() => {
            b1.style.transform = `rotateX(${res1 === 0 ? 180 : 0}deg) rotateZ(${Math.random()*30-15}deg)`;
            b2.style.transform = `rotateX(${res2 === 0 ? 180 : 0}deg) rotateZ(${Math.random()*30-15}deg)`;

            let name = (res1 !== res2) ? "圣筊" : (res1 === 1 ? "阴筊" : "笑筊");
            let color = (res1 !== res2) ? "#00ff88" : (res1 === 1 ? "#ff4444" : "#ffcc00");

            historyResults.push(name);
            updateRecord(currentStep, name, color);
            currentStep++;

            if (currentStep < 3) {
                status.innerText = `第 ${currentStep} 掷完成`;
                btn.disabled = false;
            } else {
                status.innerText = "三掷已毕.";
                setTimeout(calculateFinalVerdict, 800);
            }
        }, 800);
    }

    function updateRecord(step, name, color) {
        const val = document.getElementById(`val-${step}`);
        document.getElementById(`slot-${step}`).classList.add('active');
        val.innerText = name; val.style.color = color;
    }

    function calculateFinalVerdict() {
        const counts = {};
        historyResults.forEach(r => counts[r] = (counts[r] || 0) + 1);
        let final = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        const box = document.getElementById('final-verdict-box');
        document.getElementById('final-title').innerText = final;
        document.getElementById('final-title').style.color = (final==="圣筊")?"#00ff88":(final==="阴筊")?"#ff4444":"#ffcc00";
        document.getElementById('final-desc').innerText = (final==="圣筊")?"佛祖应允，大吉":(final==="阴筊")?"佛祖不允，审慎考虑":"佛祖笑而不语";
        box.classList.add('show');
    }

    function closeVerdict() { document.getElementById('final-verdict-box').classList.remove('show'); }

    function resetAll() {
        currentStep = 0; historyResults = [];
        const btn = document.getElementById('tossBtn');
        btn.disabled = false; btn.innerText = "掷 筊";
        document.getElementById('status').innerText = "已重置";
        document.getElementById('final-verdict-box').classList.remove('show');
        for (let i = 0; i < 3; i++) {
            document.getElementById(`slot-${i}`).classList.remove('active');
            document.getElementById(`val-${i}`).innerText = "-";
            document.getElementById(`val-${i}`).style.color = "white";
        }
    }
</script>
</body>
</html>
