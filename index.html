<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>掷筊</title>
    <style>
        :root { --wood-red: #8b0000; --flat-red: #d32f2f; --gold: #ffd700; }
        body { background: #1a1a1a; color: white; text-align: center; font-family: "STKaiti", serif; margin: 0; }
        .container { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; perspective: 1200px; padding: 20px; }
        
        /* 记录面板 */
        .record-panel { display: flex; gap: 15px; margin-bottom: 30px; }
        .record-slot { 
            width: 90px; height: 110px; border: 2px dashed #444; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); transition: 0.3s;
        }
        .record-slot.active { border-color: var(--gold); background: rgba(255,215,0,0.1); transform: translateY(-5px); }
        .slot-tag { font-size: 14px; color: #888; margin-bottom: 5px; }
        .slot-val { font-size: 1.4rem; font-weight: bold; }

        /* 最终结论弹窗 */
        #final-verdict-box { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.95); border: 3px solid var(--gold); padding: 40px;
            border-radius: 20px; z-index: 100; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 50px rgba(255,215,0,0.3);
        }
        #final-verdict-box.show { transform: translate(-50%, -50%) scale(1); }

        /* 结果与筊杯 */
        #status { font-size: 1.2rem; color: var(--gold); height: 30px; margin-bottom: 10px; font-weight: bold; }
        .bwei-box { display: flex; gap: 60px; height: 180px; align-items: center; margin: 20px 0; }
        
        .bwei {
            position: relative; width: 120px; height: 60px;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .side-curved {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, var(--wood-red) 0%, #4a0000 100%);
            border-radius: 120px 120px 15px 15px;
            backface-visibility: hidden;
            box-shadow: inset 0 -5px 15px rgba(0,0,0,0.5);
        }
        .side-flat {
            position: absolute; width: 100%; height: 100%;
            background: var(--flat-red);
            border-radius: 120px 120px 15px 15px;
            transform: rotateX(180deg);
            backface-visibility: hidden;
            border-bottom: 3px solid #7b0000;
        }

        .tossing { animation: toss-anim 0.8s ease-in-out; }
        @keyframes toss-anim {
            0% { transform: translateY(0) rotateX(0); }
            50% { transform: translateY(-200px) rotateX(720deg) rotateY(180deg); }
            100% { transform: translateY(0); }
        }

        /* 控制区 */
        .controls { margin-top: 40px; display: flex; gap: 20px; }
        button {
            padding: 12px 40px; font-size: 1.2rem; border-radius: 30px; cursor: pointer;
            font-family: inherit; transition: 0.3s;
        }
        .btn-main { background: #b71c1c; color: var(--gold); border: 2px solid var(--gold); }
        .btn-sub { background: transparent; color: #888; border: 1px solid #444; font-size: 1rem; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container">
    <h1>⛩️ 虔诚祈祷 三掷定音 ⛩️</h1>

    <div class="record-panel">
        <div class="record-slot" id="slot-0"><span class="slot-tag">第一掷</span><span class="slot-val" id="val-0">-</span></div>
        <div class="record-slot" id="slot-1"><span class="slot-tag">第二掷</span><span class="slot-val" id="val-1">-</span></div>
        <div class="record-slot" id="slot-2"><span class="slot-tag">第三掷</span><span class="slot-val" id="val-2">-</span></div>
    </div>

    <div id="status">请点击掷筊</div>

    <div class="bwei-box">
        <div id="bwei1" class="bwei"><div class="side-curved"></div><div class="side-flat"></div></div>
        <div id="bwei2" class="bwei"><div class="side-curved"></div><div class="side-flat"></div></div>
    </div>

    <div class="controls">
        <button id="tossBtn" class="btn-main" onclick="toss()">掷 筊</button>
        <button class="btn-sub" onclick="resetAll()">重新开始</button>
    </div>
</div>

<div id="final-verdict-box">
    <div style="font-size: 1.5rem; color: #aaa;">佛祖最终旨意</div>
    <div id="final-title" style="font-size: 4rem; font-weight: bold; margin: 20px 0;"></div>
    <div id="final-desc" style="font-size: 1.2rem; color: #fff; margin-bottom: 30px;"></div>
    <button class="btn-main" onclick="closeVerdict()">了然</button>
</div>

<script>
    let currentStep = 0;
    let historyResults = []; // 存储三次的结果名称

    function toss() {
        if (currentStep >= 3) return;

        const b1 = document.getElementById('bwei1');
        const b2 = document.getElementById('bwei2');
        const tossBtn = document.getElementById('tossBtn');
        const status = document.getElementById('status');

        tossBtn.disabled = true;
        status.innerText = "佛祖定夺中...";

        b1.classList.remove('tossing');
        b2.classList.remove('tossing');
        void b1.offsetWidth; 

        const res1 = Math.random() > 0.5 ? 0 : 1;
        const res2 = Math.random() > 0.5 ? 0 : 1;

        b1.classList.add('tossing');
        b2.classList.add('tossing');

        setTimeout(() => {
            b1.style.transform = `rotateX(${res1 === 0 ? 180 : 0}deg) rotateZ(${Math.random()*40-20}deg)`;
            b2.style.transform = `rotateX(${res2 === 0 ? 180 : 0}deg) rotateZ(${Math.random()*40-20}deg)`;

            let resultName = "";
            let color = "";
            if (res1 !== res2) { resultName = "圣筊"; color = "#00ff88"; }
            else if (res1 === 1) { resultName = "阴筊"; color = "#ff4444"; }
            else { resultName = "笑筊"; color = "#ffcc00"; }

            historyResults.push(resultName);
            updateRecord(currentStep, resultName, color);
            
            currentStep++;
            if (currentStep < 3) {
                status.innerText = `第 ${currentStep} 掷完成`;
                tossBtn.disabled = false;
            } else {
                status.innerText = "三掷已毕.";
                setTimeout(calculateFinalVerdict, 1000); // 延迟1秒显示最终汇总
            }
        }, 800);
    }

    function updateRecord(step, name, color) {
        const slot = document.getElementById(`slot-${step}`);
        const val = document.getElementById(`val-${step}`);
        slot.classList.add('active');
        val.innerText = name;
        val.style.color = color;
    }

    function calculateFinalVerdict() {
        // 统计各结果出现频率
        const counts = {};
        historyResults.forEach(r => counts[r] = (counts[r] || 0) + 1);

        // 找到出现次数最多的结果
        let finalVerdict = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);

        const box = document.getElementById('final-verdict-box');
        const title = document.getElementById('final-title');
        const desc = document.getElementById('final-desc');

        title.innerText = finalVerdict;
        
        if (finalVerdict === "圣筊") {
            title.style.color = "#00ff88";
            desc.innerText = "佛祖应允，大吉";
        } else if (finalVerdict === "阴筊") {
            title.style.color = "#ff4444";
            desc.innerText = "佛祖不允，请审慎考虑";
        } else {
            title.style.color = "#ffcc00";
            desc.innerText = "佛祖多次笑而不语";
        }

        box.classList.add('show');
    }

    function closeVerdict() {
        document.getElementById('final-verdict-box').classList.remove('show');
        document.getElementById('tossBtn').innerText = "请重置";
    }

    function resetAll() {
        currentStep = 0;
        historyResults = [];
        document.getElementById('tossBtn').disabled = false;
        document.getElementById('tossBtn').innerText = "掷 筊";
        document.getElementById('status').innerText = "已重置，请重新请示";
        document.getElementById('final-verdict-box').classList.remove('show');
        
        for (let i = 0; i < 3; i++) {
            const slot = document.getElementById(`slot-${i}`);
            const val = document.getElementById(`val-${i}`);
            slot.classList.remove('active');
            val.innerText = "-";
            val.style.color = "white";
        }
    }
</script>

</body>

</html>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
    /* 防止微信下拉出现“网页由xxx提供”的深色背景，提升沉浸感 */
    html, body { 
        overscroll-behavior-y: contain; 
        touch-action: pan-x pan-y;
    }
</style>


