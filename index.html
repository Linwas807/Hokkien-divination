<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>掷筊 - 佛祖灵应</title>
    <style>
        :root { --wood-red: #8b0000; --flat-red: #d32f2f; --gold: #ffd700; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            background: radial-gradient(circle at center, #2c0000 0%, #1a1a1a 100%); 
            color: white; 
            text-align: center; 
            font-family: "STKaiti", "KaiTi", serif; 
            margin: 0; 
            overflow: hidden; /* 禁止页面滚动 */
            touch-action: none; /* 禁止微信下拉回弹 */
        }

        .container { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-between; /* 垂直方向均匀分配 */
            perspective: 1200px; 
            padding: 5vh 20px; /* 使用视口高度留白 */
        }

        h1 { font-size: 1.6rem; margin: 0; color: var(--gold); text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        /* 记录面板自适应 */
        .record-panel { display: flex; gap: 10px; width: 100%; justify-content: center; }
        .record-slot { 
            flex: 1; max-width: 85px; height: 90px; 
            border: 1px dashed #666; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); transition: 0.3s;
        }
        .record-slot.active { border-color: var(--gold); background: rgba(255,215,0,0.1); transform: translateY(-3px); }
        .slot-tag { font-size: 12px; color: #888; margin-bottom: 5px; }
        .slot-val { font-size: 1.2rem; font-weight: bold; }

        /* 筊杯区域自适应 */
        .bwei-box { 
            display: flex; 
            gap: 15%; 
            height: 25vh; 
            align-items: center; 
            justify-content: center;
            width: 100%;
        }
        
        .bwei {
            position: relative; 
            width: 28vw; /* 随屏幕宽度变化 */
            max-width: 120px;
            aspect-ratio: 2 / 1; /* 保持月牙比例 */
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .side-curved {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, var(--wood-red) 0%, #4a0000 100%);
            border-radius: 120px 120px 15px 15px;
            backface-visibility: hidden;
            box-shadow: inset 0 -5px 15px rgba(0,0,0,0.5);
        }
        .side-flat {
            position: absolute; width: 100%; height: 100%;
            background: var(--flat-red);
            border-radius: 120px 120px 15px 15px;
            transform: rotateX(180deg);
            backface-visibility: hidden;
            border-bottom: 3px solid #7b0000;
        }

        .tossing { animation: toss-anim 0.8s ease-in-out; }
        @keyframes toss-anim {
            0% { transform: translateY(0) rotateX(0); }
            50% { transform: translateY(-35vh) rotateX(720deg) rotateY(180deg); }
            100% { transform: translateY(0); }
        }

        /* 状态显示 */
        #status { font-size: 1.1rem; color: var(--gold); height: 1.5rem; font-weight: bold; }

        /* 弹窗自适应 */
        #final-verdict-box { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 85%; max-width: 320px;
            background: rgba(15,0,0,0.98); border: 2px solid var(--gold); padding: 30px;
            border-radius: 20px; z-index: 100; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 50px rgba(255,215,0,0.3);
        }
        #final-verdict-box.show { transform: translate(-50%, -50%) scale(1); }

        /* 控制区 */
        .controls { width: 100%; max-width: 280px; display: flex; flex-direction: column; gap: 15px; }
        button {
            width: 100%; padding: 14px; font-size: 1.2rem; border-radius: 30px; cursor: pointer;
            font-family: inherit; transition: 0.3s; border: none;
        }
        .btn-main { background: #b71c1c; color: var(--gold); border: 2px solid var(--gold); }
        .btn-sub { background: transparent; color: #888; border: 1px solid #444; font-size: 0.9rem; }
        button:disabled { opacity: 0.3; }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div class="container">
    <h1>⛩️ 虔诚祈祷 三掷定音 ⛩️</h1>

    <div class="record-panel">
        <div class="record-slot" id="slot-0"><span class="slot-tag">第一掷</span><span class="slot-val" id="val-0">-</span></div>
        <div class="record-slot" id="slot-1"><span class="slot-tag">第二掷</span><span class="slot-val" id="val-1">-</span></div>
        <div class="record-slot" id="slot-2"><span class="slot-tag">第三掷</span><span class="slot-val" id="val-2">-</span></div>
    </div>

    <div id="status">请点击掷筊</div>

    <div class="bwei-box">
        <div id="bwei1" class="bwei"><div class="side-curved"></div><div class="side-flat"></div></div>
        <div id="bwei2" class="bwei"><div class="side-curved"></div><div class="side-flat"></div></div>
    </div>

    <div class="controls">
        <button id="tossBtn" class="btn-main" onclick="toss()">掷 筊</button>
        <button class="btn-sub" onclick="resetAll()">重新开始</button>
    </div>
</div>

<div id="final-verdict-box">
    <div style="font-size: 1.1rem; color: #aaa;">佛祖最终旨意</div>
    <div id="final-title" style="font-size: 3.5rem; font-weight: bold; margin: 15px 0;"></div>
    <div id="final-desc" style="font-size: 1.1rem; color: #fff; margin-bottom: 25px;"></div>
    <button class="btn-main" style="padding: 10px;" onclick="closeVerdict()">了然</button>
</div>

<script>
    let currentStep = 0;
    let historyResults = [];

    function toss() {
        if (currentStep >= 3) return;

        const b1 = document.getElementById('bwei1');
        const b2 = document.getElementById('bwei2');
        const tossBtn = document.getElementById('tossBtn');
        const status = document.getElementById('status');

        tossBtn.disabled = true;
        status.innerText = "佛祖定夺中...";

        b1.classList.remove('tossing');
        b2.classList.remove('tossing');
        void b1.offsetWidth; 

        const res1 = Math.random() > 0.5 ? 0 : 1;
        const res2 = Math.random() > 0.5 ? 0 : 1;

        b1.classList.add('tossing');
        b2.classList.add('tossing');

        // 手机震动反馈 (如果设备支持)
        if (window.navigator.vibrate) window.navigator.vibrate(50);

        setTimeout(() => {
            b1.style.transform = `rotateX(${res1 === 0 ? 180 : 0}deg) rotateZ(${Math.random()*40-20}deg)`;
            b2.style.transform = `rotateX(${res2 === 0 ? 180 : 0}deg) rotateZ(${Math.random()*40-20}deg)`;

            let resultName = "";
            let color = "";
            if (res1 !== res2) { resultName = "圣筊"; color = "#00ff88"; }
            else if (res1 === 1) { resultName = "阴筊"; color = "#ff4444"; }
            else { resultName = "笑筊"; color = "#ffcc00"; }

            historyResults.push(resultName);
            updateRecord(currentStep, resultName, color);
            
            currentStep++;
            if (currentStep < 3) {
                status.innerText = `第 ${currentStep} 掷完成`;
                tossBtn.disabled = false;
            } else {
                status.innerText = "三掷已毕.";
                setTimeout(calculateFinalVerdict, 1000);
            }
        }, 800);
    }

    function updateRecord(step, name, color) {
        const slot = document.getElementById(`slot-${step}`);
        const val = document.getElementById(`val-${step}`);
        slot.classList.add('active');
        val.innerText = name;
        val.style.color = color;
    }

    function calculateFinalVerdict() {
        const counts = {};
        historyResults.forEach(r => counts[r] = (counts[r] || 0) + 1);
        let finalVerdict = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);

        const box = document.getElementById('final-verdict-box');
        const title = document.getElementById('final-title');
        const desc = document.getElementById('final-desc');

        title.innerText = finalVerdict;
        
        if (finalVerdict === "圣筊") {
            title.style.color = "#00ff88";
            desc.innerText = "佛祖应允，大吉";
        } else if (finalVerdict === "阴筊") {
            title.style.color = "#ff4444";
            desc.innerText = "佛祖不允，请审慎考虑";
        } else {
            title.style.color = "#ffcc00";
            desc.innerText = "佛祖多次笑而不语";
        }

        box.classList.add('show');
        if (window.navigator.vibrate) window.navigator.vibrate([100, 50, 100]);
    }

    function closeVerdict() {
        document.getElementById('final-verdict-box').classList.remove('show');
        document.getElementById('tossBtn').innerText = "请重置";
    }

    function resetAll() {
        currentStep = 0;
        historyResults = [];
        const btn = document.getElementById('tossBtn');
        btn.disabled = false;
        btn.innerText = "掷 筊";
        document.getElementById('status').innerText = "已重置，请重新请示";
        document.getElementById('final-verdict-box').classList.remove('show');
        
        for (let i = 0; i < 3; i++) {
            const slot = document.getElementById(`slot-${i}`);
            const val = document.getElementById(`val-${i}`);
            slot.classList.remove('active');
            val.innerText = "-";
            val.style.color = "white";
        }
    }
</script>

</body>
</html>
